<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Manage Exams - SESD Portal</title>
    <link rel="stylesheet" href="../assets/css/main.css">
    <link rel="stylesheet" href="../assets/css/student.css">
    <style>
        .creator-container { display: grid; grid-template-columns: 350px 1fr; gap: 2rem; align-items: start; }
        .question-builder { background: white; padding: 2rem; border-radius: 16px; border: 1px solid #e2e8f0; }
        .added-question { background: #f8fafc; padding: 1rem; margin-bottom: 1rem; border-radius: 8px; border-left: 4px solid #2563eb; position: relative; }
        .delete-q-btn { position: absolute; top: 10px; right: 10px; color: #ef4444; cursor: pointer; }
        .access-toggle { background: #f1f5f9; padding: 4px; border-radius: 8px; display: flex; margin-bottom: 1rem; }
        .access-btn { flex: 1; padding: 8px; border: none; background: none; cursor: pointer; border-radius: 6px; font-weight: 500; color: #64748b; }
        .access-btn.active { background: white; color: #2563eb; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="container nav-flex">
            <a href="dashboard.html" class="logo">SESD Admin</a>
            <ul class="nav-links">
                <li><a href="dashboard.html">Dashboard</a></li>
                <li><a href="students.html">Students</a></li>
                <li><a href="exams.html" class="active">Exams</a></li>
                <li><a href="grade.html">Grades</a></li>
                <li><button id="logoutBtn" class="btn btn-secondary">Logout</button></li>
            </ul>
        </div>
    </nav>

    <main class="container dashboard-container">
        <header class="dashboard-header">
            <div><h1 id="formTitle">Exam Manager</h1><p>Create new exams or manage existing ones.</p></div>
        </header>

        <div class="exam-tabs">
            <button class="tab-btn active" onclick="switchProfTab('create')">Create New Exam</button>
            <button class="tab-btn" onclick="switchProfTab('list')">View My Exams</button>
        </div>

        <div id="create-tab" class="tab-content">
            <div class="creator-container">
                <div class="dashboard-card">
                    <h3>1. Exam Details</h3>
                    <div class="form-group"><label class="form-label">Exam Title</label><input type="text" id="examTitle" class="form-input" placeholder="e.g., Certification Final"></div>
                    <div class="form-group"><label class="form-label">Subject</label><select id="examSubject" class="form-input"><option>Computer Science</option><option>Mathematics</option><option>General Knowledge</option><option>Certification</option></select></div>
                    <div class="form-group"><label class="form-label">Duration (Mins)</label><input type="number" id="examDuration" class="form-input" value="60"></div>

                    <div style="margin-bottom: 1.5rem;">
                         <label class="form-label">Schedule (Optional)</label>
                         <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                             <div>
                                 <span class="text-small" style="color:#64748b">Start Date/Time</span>
                                 <input type="datetime-local" id="examStart" class="form-input" style="font-size: 0.9rem;">
                             </div>
                             <div>
                                 <span class="text-small" style="color:#64748b">End Date/Time</span>
                                 <input type="datetime-local" id="examEnd" class="form-input" style="font-size: 0.9rem;">
                             </div>
                         </div>
                    </div>
                    
                    <div style="background: #f8fafc; padding: 1rem; border-radius: 12px; border: 1px solid #e2e8f0;">
                        <label class="form-label" style="color:#0f172a; margin-bottom: 0.5rem;">Exam Access Type</label>
                        <div class="access-toggle">
                            <button class="access-btn active" onclick="toggleAccessType('batch')" id="btnBatch">College Batch</button>
                            <button class="access-btn" onclick="toggleAccessType('private')" id="btnPrivate">Private Code</button>
                        </div>
                        <div id="batchAccessGroup">
                            <label class="form-label text-small">Select Batches</label>
                            <select id="examBatches" class="form-input" multiple size="3" style="font-size: 0.9rem;">
                                <option value="ALL" selected>ALL My Batches</option>
                                <option value="Batch-A">Batch A</option>
                                <option value="Batch-B">Batch B</option>
                                <option value="Batch-C">Batch C</option>
                            </select>
                        </div>
                        <div id="privateAccessGroup" style="display: none;">
                            <p class="text-small" style="color: #64748b; background: #fff; padding: 10px; border-radius: 8px; border: 1px dashed #cbd5e1;">ðŸ”‘ A unique 6-digit access code will be generated when you save.</p>
                        </div>
                        <input type="hidden" id="selectedAccessType" value="batch">
                    </div>

                    <button onclick="finalizeExam()" class="btn btn-primary btn-full" style="margin-top: 1.5rem;">âœ… Save & Publish</button>
                </div>

                <div class="question-builder">
                    <h3>2. Add Questions</h3>
                    <div style="background: #f1f5f9; padding: 1.5rem; border-radius: 12px; margin-bottom: 2rem;">
                        <div class="form-group">
                            <label class="form-label">Question Type</label>
                            <select id="qType" class="form-input" onchange="toggleQuestionFields()">
                                <option value="mcq">Multiple Choice</option>
                                <option value="text">Long Text Answer</option>
                                <option value="code">Code Editor</option>
                                <option value="file">File Upload</option>
                            </select>
                        </div>
                        <div class="form-group"><label class="form-label">Question Text</label><textarea id="qText" class="form-input" rows="3" placeholder="Enter question..."></textarea></div>
                        <div class="form-group"><label class="form-label">Marks</label><input type="number" id="qMarks" class="form-input" value="1" style="width: 100px;"></div>
                        <div id="mcqFields">
                            <label class="form-label">Options (Select correct radio)</label>
                            <div class="mb-1"><input type="radio" name="correctOpt" value="0" checked> <input type="text" id="opt0" class="form-input" style="width: 80%; display: inline-block;" placeholder="Option 1"></div>
                            <div class="mb-1"><input type="radio" name="correctOpt" value="1"> <input type="text" id="opt1" class="form-input" style="width: 80%; display: inline-block;" placeholder="Option 2"></div>
                            <div class="mb-1"><input type="radio" name="correctOpt" value="2"> <input type="text" id="opt2" class="form-input" style="width: 80%; display: inline-block;" placeholder="Option 3"></div>
                            <div class="mb-1"><input type="radio" name="correctOpt" value="3"> <input type="text" id="opt3" class="form-input" style="width: 80%; display: inline-block;" placeholder="Option 4"></div>
                        </div>
                        <button onclick="addQuestionToExam()" class="btn btn-secondary" style="width: 100%; margin-top: 1rem;">+ Add Question</button>
                    </div>
                    <h3>Added Questions (<span id="qCount">0</span>)</h3>
                    <div id="addedQuestionsList"><p class="empty-state">No questions added.</p></div>
                </div>
            </div>
        </div>

        <div id="list-tab" class="tab-content" style="display: none;">
            <div class="exam-list" id="profExamList">Loading...</div>
        </div>
    </main>

    <script src="../assets/js/auth.js"></script>
    <script src="../assets/js/main.js"></script>
    <script src="../assets/js/professor.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
             const logoutBtn = document.getElementById('logoutBtn');
             if (logoutBtn && typeof handleLogout !== 'undefined') logoutBtn.addEventListener('click', handleLogout);
             if (typeof initExamManager !== 'undefined') initExamManager();
        });
        function switchProfTab(tab) {
            document.querySelectorAll('.tab-content').forEach(t => t.style.display = 'none');
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            if(tab === 'create') {
                document.getElementById('create-tab').style.display = 'block';
                document.querySelector('.tab-btn:nth-child(1)').classList.add('active');
            } else {
                document.getElementById('list-tab').style.display = 'block';
                document.querySelector('.tab-btn:nth-child(2)').classList.add('active');
                loadProfExams();
            }
        }
        function toggleAccessType(type) {
            document.getElementById('selectedAccessType').value = type;
            document.getElementById('btnBatch').className = type === 'batch' ? 'access-btn active' : 'access-btn';
            document.getElementById('btnPrivate').className = type === 'private' ? 'access-btn active' : 'access-btn';
            document.getElementById('batchAccessGroup').style.display = type === 'batch' ? 'block' : 'none';
            document.getElementById('privateAccessGroup').style.display = type === 'private' ? 'block' : 'none';
        }
    </script>
</body>
</html>