<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Manage Assessments - SESD Portal</title>
    <link rel="stylesheet" href="../assets/css/main.css">
    <link rel="stylesheet" href="../assets/css/student.css">
    <link rel="stylesheet" href="../assets/css/professor.css">
</head>
<body>
    <nav class="navbar">
        <div class="container nav-flex">
            <a href="dashboard.html" class="logo">SESD Admin</a>
            <ul class="nav-links">
                <li><a href="dashboard.html">Dashboard</a></li>
                <li><a href="students.html">Students</a></li>
                <li><a href="exams.html" class="active">Assessments</a></li>
                <li><a href="grade.html">Grades</a></li>
                <li><button id="logoutBtn" class="btn btn-secondary">Logout</button></li>
            </ul>
        </div>
    </nav>

    <main class="container dashboard-container">
        <header class="dashboard-header">
            <div><h1 id="formTitle">Assessment Manager</h1><p>Create exams, quizzes, and assignments.</p></div>
        </header>

        <div class="exam-tabs">
            <button class="tab-btn active" onclick="switchProfTab('create')">Create New</button>
            <button class="tab-btn" onclick="switchProfTab('list')">View All</button>
        </div>

        <div id="create-tab" class="tab-content">
            <div class="creator-container">
                <!-- LEFT: Details -->
                <div class="dashboard-card">
                    <h3>1. Details & Schedule</h3>
                    
                    <!-- NEW: TYPE SELECTION -->
                    <div class="form-group">
                        <label class="form-label">Assessment Type</label>
                        <select id="examType" class="form-input" style="font-weight: 600; color: #2563eb;">
                            <option value="exam">ðŸ”´ Standard Exam (Proctored)</option>
                            <option value="quiz">ðŸŸ¡ Quiz (Quick, Auto-graded)</option>
                            <option value="assignment">ðŸŸ¢ Assignment (Submission based)</option>
                        </select>
                    </div>

                    <div class="form-group"><label class="form-label">Title</label><input type="text" id="examTitle" class="form-input" placeholder="e.g., Midterm, Homework 1..."></div>
                    <div class="form-group"><label class="form-label">Subject/Course</label><select id="examSubject" class="form-input"><option>Computer Science</option><option>Mathematics</option><option>General Knowledge</option><option>Certification Course</option></select></div>
                    <div class="form-group"><label class="form-label">Duration (Minutes)</label><input type="number" id="examDuration" class="form-input" value="60"></div>

                    <div style="margin-bottom: 1.5rem; background: #f8fafc; padding: 1rem; border-radius: 12px; border: 1px solid #e2e8f0;">
                         <label class="form-label">ðŸ“… Availability Window (Optional)</label>
                         <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                             <div><span class="text-small" style="color:#64748b">Opens At</span><input type="datetime-local" id="examStart" class="form-input" style="font-size: 0.9rem;"></div>
                             <div><span class="text-small" style="color:#64748b">Closes At</span><input type="datetime-local" id="examEnd" class="form-input" style="font-size: 0.9rem;"></div>
                         </div>
                    </div>
                    
                    <div style="margin-bottom: 1.5rem;">
                        <label class="form-label">Access Control</label>
                        <div class="access-toggle">
                            <button class="access-btn active" onclick="toggleAccessType('batch')" id="btnBatch">Batch Assigned</button>
                            <button class="access-btn" onclick="toggleAccessType('private')" id="btnPrivate">Private Code</button>
                        </div>
                        <div id="batchAccessGroup">
                            <select id="examBatches" class="form-input" multiple size="3" style="font-size: 0.9rem;">
                                <option value="ALL" selected>ALL My Batches</option>
                                <option value="Batch-A">Batch A</option>
                                <option value="Batch-B">Batch B</option>
                                <option value="Batch-C">Batch C</option>
                            </select>
                        </div>
                        <div id="privateAccessGroup" style="display: none;">
                            <p class="text-small" style="padding: 8px; background: #f0f9ff; color: #0369a1; border-radius: 6px;">ðŸ”‘ Code generated on save.</p>
                        </div>
                        <input type="hidden" id="selectedAccessType" value="batch">
                    </div>

                    <!-- NEW: CERTIFICATION TOGGLE -->
                    <div class="form-group" style="display: flex; align-items: center; gap: 0.5rem; padding: 1rem; border: 2px dashed #fbbf24; border-radius: 8px; background: #fffbeb;">
                        <input type="checkbox" id="hasCertificate" style="width: 20px; height: 20px;">
                        <label for="hasCertificate" style="font-weight: 600; color: #92400e; cursor: pointer;">ðŸ† Award Certificate if score > 70%</label>
                    </div>

                    <button onclick="finalizeExam()" class="btn btn-primary btn-full" style="margin-top: 1rem;">âœ… Publish Assessment</button>
                </div>

                <!-- RIGHT: Question Builder -->
                <div class="question-builder">
                    <h3>2. Content Builder</h3>
                    <div style="background: #f1f5f9; padding: 1.5rem; border-radius: 12px; margin-bottom: 2rem;">
                        <div class="form-group">
                            <label class="form-label">Content Type</label>
                            <select id="qType" class="form-input" onchange="toggleQuestionFields()">
                                <option value="mcq">Multiple Choice</option>
                                <option value="text">Written Response</option>
                                <option value="code">Code Submission</option>
                                <option value="file">File Upload (PDF/Zip)</option>
                            </select>
                        </div>
                        <div class="form-group"><label class="form-label">Prompt / Question</label><textarea id="qText" class="form-input" rows="3" placeholder="Enter question text..."></textarea></div>
                        <div class="form-group"><label class="form-label">Points</label><input type="number" id="qMarks" class="form-input" value="5" style="width: 100px;"></div>
                        <div id="mcqFields">
                            <label class="form-label">Options (Check correct answer)</label>
                            <div class="mb-1"><input type="radio" name="correctOpt" value="0" checked> <input type="text" id="opt0" class="form-input" style="width: 80%; display: inline-block;" placeholder="Option A"></div>
                            <div class="mb-1"><input type="radio" name="correctOpt" value="1"> <input type="text" id="opt1" class="form-input" style="width: 80%; display: inline-block;" placeholder="Option B"></div>
                            <div class="mb-1"><input type="radio" name="correctOpt" value="2"> <input type="text" id="opt2" class="form-input" style="width: 80%; display: inline-block;" placeholder="Option C"></div>
                            <div class="mb-1"><input type="radio" name="correctOpt" value="3"> <input type="text" id="opt3" class="form-input" style="width: 80%; display: inline-block;" placeholder="Option D"></div>
                        </div>
                        <button onclick="addQuestionToExam()" class="btn btn-secondary" style="width: 100%; margin-top: 1rem;">+ Add to Assessment</button>
                    </div>
                    <h3>Items (<span id="qCount">0</span>)</h3>
                    <div id="addedQuestionsList"><p class="empty-state">Empty.</p></div>
                </div>
            </div>
        </div>

        <div id="list-tab" class="tab-content" style="display: none;">
            <div class="exam-list" id="profExamList">Loading...</div>
        </div>
    </main>

    <script src="../assets/js/auth.js"></script>
    <script src="../assets/js/main.js"></script>
    <script src="../assets/js/professor.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
             const logoutBtn = document.getElementById('logoutBtn');
             if (logoutBtn && typeof handleLogout !== 'undefined') logoutBtn.addEventListener('click', handleLogout);
             if (typeof initExamManager !== 'undefined') initExamManager();
        });
        function switchProfTab(tab) {
            document.querySelectorAll('.tab-content').forEach(t => t.style.display = 'none');
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            if(tab === 'create') {
                document.getElementById('create-tab').style.display = 'block';
                document.querySelector('.tab-btn:nth-child(1)').classList.add('active');
            } else {
                document.getElementById('list-tab').style.display = 'block';
                document.querySelector('.tab-btn:nth-child(2)').classList.add('active');
                loadProfExams();
            }
        }
        function toggleAccessType(type) {
            document.getElementById('selectedAccessType').value = type;
            document.getElementById('btnBatch').className = type === 'batch' ? 'access-btn active' : 'access-btn';
            document.getElementById('btnPrivate').className = type === 'private' ? 'access-btn active' : 'access-btn';
            document.getElementById('batchAccessGroup').style.display = type === 'batch' ? 'block' : 'none';
            document.getElementById('privateAccessGroup').style.display = type === 'private' ? 'block' : 'none';
        }
    </script>
</body>
</html>